<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MedBuddy</title>
  <link rel="icon" type="image/png" href="favicon.png" />
  <link rel="stylesheet" href="hackathontask.css" />

</head>

<body>
  <div class="main">
    <div class="navbar">

      <div class="lower-out">
        <div class="lower-nav">
          <div class="site-name">
            <h1>MedBuddy</h1>
          </div>
          <div class="nav-links">
            <ul>
              <li>Diagnostic Tools</li>
              <li>Symptoms</li>
              <li>Conditons</li>
              <li>Health And Wellness</li>

            </ul>
          </div>
          <div class="nav-button">
            <button><b>Online<br>Consultation</b></button>
            <button><b>Medical Facilities<br>Near Me</b></button>
          </div>
        </div>
      </div>
    </div>
    <div class="pg1">
      <div class="pg1-inner">
        <div class="pg1-content">
          <span class="tilted">Hello</span>
          <h1>WE KNOW <br />HOW TO TALK... <br />ABOUT YOUR HEALTH</h1>
          <p>
            "<b>MedBuddy</b>" provides accurate, reliable, and easy-to-understand health information, helping you
            navigate your symptoms and make informed decisions about your well-being."
          </p>
          <button id="lets-talk-btn">Let's Talk</button> <!-- Button to open the chatbot -->
        </div>
        <div class="img-outer">
          <div class="img-box">
            <img src="chatbot.webp" alt="Chatbot Image" />
          </div>
        </div>
      </div>
    </div>

    <!-- Floating Chatbot Container -->
    <div id="chat-container" style="display:none;">
      <div id="chat-header">
        <button id="close-chat">X</button>
        <h3>Chat with MedBuddy</h3>
        <button id="toggle-sidebar" title="Show/Hide chat history" aria-pressed="false">☰</button>
      </div>
      <div id="chat-body">
        <aside id="chat-sidebar">
          <div class="sidebar-actions">
            <button id="new-chat">+ New Chat</button>
            <button id="delete-chat" class="danger">Delete Chat</button>
          </div>
          <ul id="conversation-list"></ul>
        </aside>
        <section id="chat-main">
          <div id="chat-box"></div>
          <div id="chat-input-row" style="display:flex; align-items:center; gap:8px; padding: 0.75rem 1rem;">
            <input type="text" id="user-input" placeholder="Type your message here">
            <button id="mic-button" aria-label="Start voice input" title="Voice input">
              <span id="mic-icon">🎤</span>
            </button>
            <button id="send-button">Send</button>
          </div>
          <div id="voice-status" style="display:none; padding: 0 1rem 1rem 1rem; color:#6b7280; font-size:12px;">Listening… tap to stop</div>
        </section>
      </div>
    </div>

    <div class="pg2">
      <div class="pg2-inner">
        <div class="pg2-content">
          <span class="tilted">Services</span>
          <h1>Services We Offer</h1>
          <div class="card-container">
            <div class="pg2-cards hoverme">
              <div class="inner-card">
                <h1>01</h1>
                <h2>Use our A.I. to figure out what to do</h2>
                <div class="pg2_card_img"><img src="f0a01072d758c6e01ca7f7737c237fe250bfd06a-900x750.avif" alt=""
                    class="p2c2-img c1img"></div>
                <p>
                  Your situation is specific to you. Our A.I. asks questions and helps narrow down what is going on
                  based on your answers. No more guessing and filling in the blanks. It's like talking to your friend
                  who happens to be a doctor.
                </p>
                <div class=""></div>
              </div>
            </div>
            <div class="pg2-cards hoverme">
              <div class="inner-card">
                <h1>02</h1>
                <h2>Read our content written by clinicians</h2>
                <div class="pg2_card_img"><img src="pg2-c2img.avif" alt="" class="p2c2-img"></div>
                <p>
                  Wouldn't that be great if the content you read was actually scientifically vetted by real experts?
                  Look no further.
                </p>
                <div class=""></div>
              </div>
            </div>
            <div class="pg2-cards hoverme">
              <div class="inner-card">
                <h1>03</h1>
                <h2>Check out our reviews and Top 10 lists</h2>
                <div class="pg2_card_img"><img src="pg2-c3img.avif" alt="" class="p2c2-img c3img"></div>
                <p>
                  Now that we've helped you narrow things down with both A.I. and medical experts, find the right
                  product, service or doctor for you with the help of our team of reviewers.
                </p>
                <div class=""></div>
              </div>
            </div>
            <div class="pg2-cards hoverme">
              <div class="inner-card">
                <h1>04</h1>
                <h2>Get personalized action plans from A.I.</h2>
                <div class="pg2_card_img"><img src="pg2-c4img.png" alt="" class="p2c2-img c3img"></div>
                <p>
                  Our A.I. doesn’t just diagnose, it creates step-by-step plans tailored to your needs. Whether it’s wellness routines,
                  treatment options, or specialist referrals, you’ll leave with a clear path forward, backed by clinical expertise.
                </p>
                <div class=""></div>
              </div>
            </div>
            <div class="pg2-cards hoverme">
              <div class="inner-card">
                <h1>05</h1>
                <h2>Monitor your health with A.I. insights</h2>
                <div class="pg2_card_img"><img src="pg2-c5img.png" alt="" class="p2c2-img c3img"></div>
                <p>
                  Our A.I. keeps track of patterns in your symptoms, responses to treatments, and lifestyle changes—giving you 
                  intelligent updates and early alerts that help you stay one step ahead in your health journey.
                </p>
                <div class=""></div>
              </div>
            </div>
            <div class="pg2-cards hoverme">
              <div class="inner-card">
                <h1>06</h1>
                <h2>Get smarter follow-ups through A.I.</h2>
                <div class="pg2_card_img"><img src="pg2-c6img.png" alt="" class="p2c2-img c3img"></div>
                <p>
                  Your care doesn’t stop after one session. Our A.I. provides dynamic follow-ups tailored to how you’re 
                  doing—whether it’s adjusting a plan, suggesting check-ins, or recommending tests, just like a doctor who remembers everything.

                </p>
                <div class=""></div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
  </div>

  <!-- Mini Chat FAB -->
  <button id="chat-fab" aria-label="Open chat" title="Chat with MedBuddy" style="display:none;"><img src="chatbot.webp" alt="Chatbot" /></button>

  <div class="pg4">
    <div class="pg4-inner">
      <div class="pg4-content">
        <span class="tilted">Articles</span>

        <h1>Top Articles</h1>
        <div class="pg4card-container">
          <!-- Card 1: Cause of Rashes -->
          <div class="pg4-cards">
            <div class="pg4-card-front">
              <div class="pg4inner-card">
                <img src="rashes.png" alt="" />
              </div>
              <div class="pg4ic">
                <div class="pg4innercard-content">
                  <h1>Cause Of Rashes</h1>
                </div>
              </div>
            </div>
            <div class="pg4-card-back">
              <p>Rashes can occur due to various causes, such as allergic reactions, infections, or skin conditions like
                eczema. Some rashes are temporary, while others may signal a more serious underlying issue. Common types
                include hives, contact dermatitis, and fungal infections. If a rash is persistent or accompanied by
                other symptoms like fever, it’s important to seek medical advice. Understanding the cause of a rash
                helps in determining the right treatment, whether it’s topical creams, medications, or lifestyle
                changes.</p>
            </div>
          </div>

          <!-- Card 2: Common Cold -->
          <div class="pg4-cards">
            <div class="pg4-card-front">
              <div class="pg4inner-card">
                <img src="cold.png" alt="" />
              </div>
              <div class="pg4ic">
                <div class="pg4innercard-content">
                  <h1>Common Cold</h1>
                </div>
              </div>
            </div>
            <div class="pg4-card-back">
              <p>The common cold is one of the most frequent illnesses caused by viruses, especially rhinoviruses.
                Symptoms include a runny nose, sore throat, sneezing, and mild cough. Although it's not usually severe,
                it can still cause discomfort and affect daily activities. The cold spreads easily through droplets from
                sneezing or coughing. Rest, fluids, and over-the-counter medications can help relieve symptoms. It’s
                essential to avoid spreading the virus by practicing good hygiene and staying home when feeling sick.
              </p>
            </div>
          </div>

          <!-- Card 3: Headache Relief -->
          <div class="pg4-cards">
            <div class="pg4-card-front">
              <div class="pg4inner-card">
                <img src="headache.avif" alt="" />
              </div>
              <div class="pg4ic">
                <div class="pg4innercard-content">
                  <h1>Headache Relief - 23 Ways to Stop a Headache</h1>
                </div>
              </div>
            </div>
            <div class="pg4-card-back">
              <p>Headaches are a common issue that can be triggered by stress, dehydration, lack of sleep, or underlying
                medical conditions. Relief strategies range from natural remedies like drinking water or applying a cold
                compress to over-the-counter pain relief medications. Reducing stress through mindfulness, regular
                exercise, and improving posture can also help manage and prevent headaches. In more severe cases,
                medical treatments like prescription medications or specialized therapies may be required.</p>
            </div>
          </div>

          <!-- Card 4: Painful Urination -->
          <div class="pg4-cards">
            <div class="pg4-card-front">
              <div class="pg4inner-card">
                <img src="pain urin.avif" alt="" />
              </div>
              <div class="pg4ic">
                <div class="pg4innercard-content">
                  <h1>Painful Urination: Symptoms, Causes & Treatments</h1>
                </div>
              </div>
            </div>
            <div class="pg4-card-back">
              <p>Painful urination, or dysuria, can be a sign of various conditions such as urinary tract infections
                (UTIs), kidney stones, or sexually transmitted diseases (STDs). It may also result from dehydration or
                bladder irritants. Associated symptoms might include frequent urination, cloudy or bloody urine, or a
                strong urge to urinate. Treatment depends on the cause, ranging from antibiotics for infections to
                lifestyle changes. Seeking medical attention is crucial for proper diagnosis and treatment..</p>
            </div>
          </div>

          <!-- Card 5: STD Symptoms -->
          <div class="pg4-cards">
            <div class="pg4-card-front">
              <div class="pg4inner-card">
                <img src="stdimg.avif" alt="" />
              </div>
              <div class="pg4ic">
                <div class="pg4innercard-content">
                  <h1>STD Or Not? 23 Reasons For STD Symptoms In Women</h1>
                </div>
              </div>
            </div>
            <div class="pg4-card-back">
              <p>STDs can cause a variety of symptoms in women, including unusual discharge, painful urination, and
                pelvic pain. However, many non-STD conditions like urinary tract infections, yeast infections, and
                hormonal changes can cause similar symptoms. It's essential for women experiencing these signs to get
                tested, as some STDs can remain asymptomatic for a long time. Early detection and treatment are vital to
                preventing complications and transmission.</p>
            </div>
          </div>

          <!-- Card 6: Lower Left Abdomen Pain -->
          <div class="pg4-cards">
            <div class="pg4-card-front">
              <div class="pg4inner-card">
                <img src="leftabd.png" alt="" />
              </div>
              <div class="pg4ic">
                <div class="pg4innercard-content">
                  <h1>Pain in Your Lower Left Abdomen</h1>
                </div>
              </div>
            </div>
            <div class="pg4-card-back">
              <p>Pain in the lower left abdomen can be caused by several factors, ranging from digestive issues like
                constipation or gas to more serious conditions such as diverticulitis or ovarian cysts. It may also
                indicate problems with the kidneys, intestines, or reproductive organs. If the pain is sharp,
                persistent, or accompanied by fever or nausea, immediate medical consultation is advised. Proper
                diagnosis through physical exams and imaging tests is crucial for effective treatment.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="pg5">
    <div class="pg5-inner">
      <div class="pg5-content">
        <span class="tilted">Testimonial</span>
        <h1>Client's Kind Word</h1>
        <div class="pg5card-container">
          <div class="pg5-cards hoverme">
            <img src="pg5-img.jpg" alt="" />
            <p>
              "The medical chatbot provided fast, accurate responses and made it easy for us to understand symptoms.
              It’s an invaluable tool for anyone looking for quick, reliable health information."
            </p>
            <h4>Mitakshi S.</h4>
            <span>Clinical Nurse Specialist – KIMS</span>
          </div>
          <div class="pg5-cards hoverme">
            <img src="pg5-img2.jpg" alt="" />
            <p>
              "We found the chatbot incredibly helpful for quick symptom checks. Its user-friendly interface and clear
              guidance allowed us to gain valuable insights without the wait."
            </p>
            <h4>Dr. Sricharan K.</h4>
            <span>Home Doctor</span>
          </div>
          <div class="pg5-cards hoverme">
            <img src="pg5-img4.png" alt="" />
            <p>
              "Our team loves using the chatbot. It’s fast, easy to navigate, and provides helpful symptom-based
              recommendations. A must-have tool for health-related queries!"
            </p>
            <h4>Rishi Verma</h4>
            <span>MBBS Student</span>
          </div>
          <div class="pg5-cards hoverme">
            <img src="pg5-img3.jpg" alt="" />
            <p>
              "The chatbot’s ability to simplify complex medical jargon into plain language is remarkable. It’s become my go-to for
              patient education, saving time and improving understanding."
            </p>
            <h4>Dr. Priya Mehta</h4>
            <span>General Physician at Apollo Hospitals</span>
          </div>
          <div class="pg5-cards hoverme">
            <img src="pg5-img5.jpeg" alt="" />
            <p>
              "This A.I.-driven tool is like having a junior doctor on standby. It’s precise, responsive, and 
              has significantly improved how we triage patient concerns in our clinic."
            </p>
            <h4>Dr. Aarav Deshmukh</h4>
            <span>Family Physician – Rainbow Clinics</span>
          </div>
          <div class="pg5-cards hoverme">
            <img src="pg5-img6.jpeg" alt="" />
            <p>
              "As someone managing a health support group, the chatbot has been a game-changer. 
              Its ability to break down symptoms and suggest relevant advice has empowered many in our community."
            </p>
            <h4>Neha Bansal</h4>
            <span>Health Educator & Community Lead</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  </div>
  </div>
  </div>
  </div>
  <script>
    // Get the elements
    const sendButton = document.getElementById('send-button');
    const userInput = document.getElementById('user-input');
    const chatBox = document.getElementById('chat-box');
    const letsTalkButton = document.getElementById('lets-talk-btn');
    const chatContainer = document.getElementById('chat-container');
    const closeButton = document.getElementById('close-chat');
    const micButton = document.getElementById('mic-button');
    const micIcon = document.getElementById('mic-icon');
    const voiceStatus = document.getElementById('voice-status');
    const chatFab = document.getElementById('chat-fab');
    const chatBody = document.getElementById('chat-body');
    const chatSidebar = document.getElementById('chat-sidebar');
    const conversationList = document.getElementById('conversation-list');
    const newChatBtn = document.getElementById('new-chat');
    const deleteChatBtn = document.getElementById('delete-chat');
    const toggleSidebarBtn = document.getElementById('toggle-sidebar');

    // System instruction for better follow-ups
    const SYSTEM_PROMPT = "You are MedBuddy, a helpful, concise medical assistant. Keep track of conversation context and answer follow-up questions based on prior messages unless the user changes topic. Always be clear and empathetic. You are not a substitute for professional care.";

    // Basic markdown formatter for bot messages
    function formatMarkdown(text) {
      if (!text) return '';
      let html = text;
      // Escape basic HTML to avoid injection, then allow our replacements
      html = html
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');
      // Bold then italics
      html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
      html = html.replace(/(?<!\*)\*(?!\*)(.+?)(?<!\*)\*(?!\*)/g, '<em>$1</em>');
      // Support underscores as well
      html = html.replace(/__(.+?)__/g, '<strong>$1</strong>');
      html = html.replace(/_(.+?)_/g, '<em>$1</em>');
      // Numbered lists: add line breaks before numbers like 1. 
      html = html.replace(/(\n|^)(\d+\.)\s/g, '<br>$2 ');
      // New lines to breaks
      html = html.replace(/\n/g, '<br>');
      // Tidy multiple breaks
      html = html.replace(/(<br>\s*){2,}/g, '<br>');
      return html;
    }

    // Conversation history for follow-up questions (persisted)
    let conversationHistory = [];
    let sessionId = null;

    function loadHistory() {
      try {
        const meta = JSON.parse(localStorage.getItem('medbuddy.sessions.meta') || '{}');
        sessionId = meta.active || null;
        // Restore sidebar preference
        const hidden = localStorage.getItem('medbuddy.sidebarHidden') === '1';
        if (hidden && chatBody) chatBody.classList.add('sidebar-hidden');
        if (toggleSidebarBtn) toggleSidebarBtn.setAttribute('aria-pressed', hidden ? 'true' : 'false');
        if (sessionId) {
          const saved = localStorage.getItem(`medbuddy.session.${sessionId}`);
          if (saved) {
            const parsed = JSON.parse(saved);
            if (Array.isArray(parsed)) conversationHistory = parsed;
          }
        }
        renderConversationList();
      } catch (e) { console.warn('History load failed', e); }
    }

    function saveHistory() {
      try {
        // Keep system message + last 20 messages
        const system = conversationHistory.find(m => m.role === 'system');
        const rest = conversationHistory.filter(m => m.role !== 'system');
        const trimmed = [system || { role: 'system', content: SYSTEM_PROMPT }, ...rest.slice(-20)];
        if (!sessionId) sessionId = createNewSessionId();
        localStorage.setItem(`medbuddy.session.${sessionId}`, JSON.stringify(trimmed));
        const meta = JSON.parse(localStorage.getItem('medbuddy.sessions.meta') || '{}');
        const sessions = meta.sessions || [];
        if (!sessions.find(s => s.id === sessionId)) {
          sessions.unshift({ id: sessionId, title: generateTitleFrom(trimmed) });
        } else {
          const s = sessions.find(s => s.id === sessionId);
          s.title = generateTitleFrom(trimmed);
        }
        localStorage.setItem('medbuddy.sessions.meta', JSON.stringify({ active: sessionId, sessions: sessions.slice(0, 25) }));
        renderConversationList();
      } catch (e) { console.warn('History save failed', e); }
    }

    function createNewSessionId() {
      return `s_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;
    }

    function generateTitleFrom(messages) {
      const firstUser = messages.find(m => m.role === 'user');
      if (!firstUser) return 'New conversation';
      const text = firstUser.content.trim();
      return (text.length > 28 ? text.slice(0, 28) + '…' : text) || 'New conversation';
    }

    function renderConversationList() {
      if (!conversationList) return;
      const meta = JSON.parse(localStorage.getItem('medbuddy.sessions.meta') || '{}');
      const sessions = meta.sessions || [];
      conversationList.innerHTML = '';
      sessions.forEach(s => {
        const li = document.createElement('li');
        li.className = `conv-item${s.id === meta.active ? ' active' : ''}`;
        li.textContent = s.title || 'Conversation';
        li.title = s.title || 'Conversation';
        li.dataset.id = s.id;
        conversationList.appendChild(li);
      });
    }

    function switchSession(id) {
      try {
        const saved = localStorage.getItem(`medbuddy.session.${id}`);
        if (saved) {
          sessionId = id;
          conversationHistory = JSON.parse(saved);
          const meta = JSON.parse(localStorage.getItem('medbuddy.sessions.meta') || '{}');
          localStorage.setItem('medbuddy.sessions.meta', JSON.stringify({ active: id, sessions: meta.sessions || [] }));
          // Refresh list highlight
          renderConversationList();
          // Set aria-selected on active item
          const activeEl = conversationList && conversationList.querySelector(`.conv-item[data-id="${id}"]`);
          if (activeEl) {
            conversationList.querySelectorAll('.conv-item').forEach(el => el.setAttribute('aria-selected', 'false'));
            activeEl.setAttribute('aria-selected', 'true');
          }
          // Re-render chat UI
          chatBox.innerHTML = '';
          conversationHistory.forEach(msg => {
            if (msg.role === 'user') {
              const el = document.createElement('div');
              el.classList.add('user-message');
              el.textContent = msg.content;
              chatBox.appendChild(el);
            } else if (msg.role === 'assistant') {
              const el = document.createElement('div');
              el.classList.add('bot-message');
              el.innerHTML = msg.content.replace(/(\d+\.) /g, '<br>$1 ').replace(/^<br>/, '');
              chatBox.appendChild(el);
            }
          });
          chatBox.scrollTop = chatBox.scrollHeight;
        }
      } catch(e) { console.warn('Switch session failed', e); }
    }

    // Delegate clicks to support dynamic items reliably
    if (conversationList) {
      conversationList.addEventListener('click', (e) => {
        const item = e.target.closest('.conv-item');
        if (!item) return;
        switchSession(item.dataset.id);
      });
    }

    newChatBtn.addEventListener('click', () => {
      sessionId = createNewSessionId();
      conversationHistory = [{ role: 'system', content: SYSTEM_PROMPT }];
      chatBox.innerHTML = '';
      saveHistory();
      userInput.focus();
    });

    // Delete current chat session
    deleteChatBtn.addEventListener('click', () => {
      try {
        const meta = JSON.parse(localStorage.getItem('medbuddy.sessions.meta') || '{}');
        const sessions = meta.sessions || [];
        if (!sessionId) return;
        // Remove current session storage
        localStorage.removeItem(`medbuddy.session.${sessionId}`);
        // Remove from sessions list
        const remaining = sessions.filter(s => s.id !== sessionId);
        // Pick next active (first remaining) or create a new one
        if (remaining.length > 0) {
          const nextId = remaining[0].id;
          localStorage.setItem('medbuddy.sessions.meta', JSON.stringify({ active: nextId, sessions: remaining }));
          switchSession(nextId);
        } else {
          // No sessions left; start fresh
          localStorage.setItem('medbuddy.sessions.meta', JSON.stringify({ active: null, sessions: [] }));
          sessionId = createNewSessionId();
          conversationHistory = [{ role: 'system', content: SYSTEM_PROMPT }];
          chatBox.innerHTML = '';
          saveHistory();
        }
        renderConversationList();
      } catch (e) {
        console.warn('Delete chat failed', e);
      }
    });

    // When the user clicks "Let's Talk", show the chat container
    letsTalkButton.addEventListener('click', () => {
      chatContainer.style.display = 'block';  // Show chat container
      chatContainer.style.position = 'fixed'; // Make it float
      chatContainer.style.right = '10px';     // Position it on the right
      chatContainer.style.bottom = '10px';    // Position it at the bottom
      chatContainer.style.zIndex = '1000';    // Ensure it's on top

      // Rehydrate UI from history (last few)
      if (chatBox.children.length === 0 && conversationHistory.length > 0) {
        conversationHistory.forEach(msg => {
          if (msg.role === 'user') {
            const el = document.createElement('div');
            el.classList.add('user-message');
            el.textContent = msg.content;
            chatBox.appendChild(el);
          } else if (msg.role === 'assistant') {
            const el = document.createElement('div');
            el.classList.add('bot-message');
            el.innerHTML = formatMarkdown(msg.content);
            chatBox.appendChild(el);
          }
        });
      }
    });

    // Close the chatbot window
    closeButton.addEventListener('click', () => {
      chatContainer.style.display = 'none';  // Hide chat container
    });

    // FAB opens chat
    chatFab.addEventListener('click', () => {
      chatContainer.style.display = 'block';
      chatContainer.style.position = 'fixed';
      chatContainer.style.right = '10px';
      chatContainer.style.bottom = '10px';
      chatContainer.style.zIndex = '1000';
    });

    // Toggle sidebar visibility
    if (toggleSidebarBtn) {
      toggleSidebarBtn.addEventListener('click', () => {
        if (!chatBody) return;
        const hidden = chatBody.classList.toggle('sidebar-hidden');
        toggleSidebarBtn.setAttribute('aria-pressed', hidden ? 'true' : 'false');
        localStorage.setItem('medbuddy.sidebarHidden', hidden ? '1' : '0');
      });
    }

    // Conversation history for follow-up questions
      // ensure system prompt exists
      if (!conversationHistory.find(m => m.role === 'system')) {
        conversationHistory.unshift({ role: 'system', content: SYSTEM_PROMPT });
        saveHistory();
      }

      sendButton.addEventListener('click', async () => {
        const message = userInput.value.trim();
        if (!message) return;

        // Add user message to chat UI
        const userMessage = document.createElement('div');
        userMessage.classList.add('user-message');
        userMessage.textContent = message;
        chatBox.appendChild(userMessage);
        userInput.value = '';

        // Add user message to conversation history
        conversationHistory.push({ role: 'user', content: message });
        saveHistory();

        try {
          // Add typing indicator
          const typingIndicator = document.createElement('div');
          typingIndicator.classList.add('bot-message');
          typingIndicator.textContent = 'Typing...';
          typingIndicator.id = 'typing-indicator';
          chatBox.appendChild(typingIndicator);

          // Call Ollama API with conversation history
          const response = await fetch('http://localhost:11434/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              model: 'phi3',
              messages: conversationHistory,
              stream: false
            })
          });

          if (!response.ok) throw new Error('Ollama not responding');

          const data = await response.json();

          // Remove typing indicator and show response
          chatBox.removeChild(typingIndicator);
          const botMessage = document.createElement('div');
          botMessage.classList.add('bot-message');
          botMessage.innerHTML = formatMarkdown(data.message.content);
          chatBox.appendChild(botMessage);

          // Add bot message to conversation history
          conversationHistory.push({ role: 'assistant', content: data.message.content });
          saveHistory();
        } catch (error) {
          console.error('Error:', error);
          const errorMessage = document.createElement('div');
          errorMessage.classList.add('error-message');
          errorMessage.textContent = 'Error: Make sure Ollama is running (ollama serve)';
          chatBox.appendChild(errorMessage);
        }
      });

    // Add Enter key support for sending messages
    userInput.addEventListener('keydown', function (event) {
      if (event.key === 'Enter') {
        sendButton.click();
      }
    });
    // Step 1: Handle the "Medical Facilities Near Me" Button
    document.querySelector('.nav-button button:nth-child(2)').addEventListener('click', function () {
      window.open('https://www.google.com/search?q=medical+facilities+near+me');
    });

    // Step 3: Handle the "Online Consultation" Button
    document.querySelector('.nav-button button:nth-child(1)').addEventListener('click', function () {
      // Open Practo (or other online consultation platform)
      window.open('https://www.practo.com/consult', '_blank'); // Redirect to Practo for consultation
    });

    // Voice recognition (Web Speech API)
    let recognition = null;
    let isListening = false;

    function supportsSpeechRecognition() {
      return 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;
    }

    function initRecognition() {
      if (!supportsSpeechRecognition()) return null;
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      const r = new SR();
      r.lang = navigator.language || 'en-US';
      r.interimResults = true;
      r.continuous = false;
      return r;
    }

    function setListeningState(listening) {
      isListening = listening;
      micButton.classList.toggle('listening', listening);
      voiceStatus.style.display = listening ? 'block' : 'none';
      micIcon.textContent = listening ? '⏺️' : '🎤';
    }

    function startListening() {
      if (!supportsSpeechRecognition()) {
        alert('Voice input not supported in this browser. Please use Chrome or Edge.');
        return;
      }
      if (!recognition) recognition = initRecognition();
      if (!recognition) return;

      let finalTranscript = '';
      setListeningState(true);
      recognition.start();

      recognition.onresult = (event) => {
        let interim = '';
        for (let i = event.resultIndex; i < event.results.length; i++) {
          const transcript = event.results[i][0].transcript;
          if (event.results[i].isFinal) {
            finalTranscript += transcript + ' ';
          } else {
            interim += transcript;
          }
        }
        userInput.value = (finalTranscript + interim).trim();
      };

      recognition.onerror = (e) => {
        console.error('Speech recognition error:', e);
        setListeningState(false);
      };

      recognition.onend = () => {
        setListeningState(false);
        // Auto-send removed: keep text in input for manual review and sending
      };
    }

    function stopListening() {
      try { recognition && recognition.stop(); } catch(e) {}
      setListeningState(false);
    }

    if (micButton) {
      micButton.addEventListener('click', (e) => {
        e.preventDefault();
        if (isListening) stopListening(); else startListening();
      });
      voiceStatus.addEventListener('click', stopListening);

      if (!supportsSpeechRecognition()) {
        micButton.disabled = true;
        micButton.title = 'Voice input not supported in this browser';
      }
    }

    // Floating FAB visibility based on hero section
    const heroSection = document.querySelector('.pg1');
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting && entry.intersectionRatio > 0.2) {
          // In hero: hide FAB
          chatFab.classList.remove('visible');
          chatFab.style.display = 'none';
        } else {
          // Scrolled past hero: show FAB
          chatFab.style.display = 'block';
          requestAnimationFrame(() => chatFab.classList.add('visible'));
        }
      });
    }, { threshold: [0, 0.2, 1] });

    if (heroSection) observer.observe(heroSection);

  </script>





</body>

</html>